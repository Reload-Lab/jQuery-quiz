/*!
 * jQuery Quiz Plugin
 * https://github.com/Reload-Lab/jQuery-quiz
 *
 * @updated Sptemeber 29, 2023
 * @version 2.1.0
 *
 * @author Domenico Gigante <domenico.gigante@reloadlab.it>
 * @copyright (c) 2023 Reload Laboratorio Multimediale <info@reloadlab.it> (httpa://www.reloadlab.it)
 * @license MIT
 */
!function(e){var t={start:"Start",prev:"Back",next:"Forward",results:"Go to results",restart:"Back to the top",error:"Error",errmsg:["Please choose an answer.","Some questions have not been answered. Please, back to the top to answer all questions."]};e.quiz=e.fn.quiz=function(n){var s,i,o,a={},r=0,u=0,l=0,d="object"==typeof this?this.first():null,c="<div>",p="quiz-container",f="quiz-body",h="quiz-buttons",v="quiz-progress",_="quiz-modal",m="quiz_responses",q="quiz_flex",w="quiz_flexfill",g="quiz_num",b="quiz_alert",T="quiz_btn",z="quiz_progressbar",y='<i class="fa fa-step-forward" aria-hidden="true"></i>',x='<i class="fa fa-repeat" aria-hidden="true"></i>',k={quizJson:null,cookieExpire:3600,hidePrevBtn:!1,hideRestartBtn:!1,fade:!0,randomQuestions:!1,numQuestions:null,onStep:function(e,t,n){n&&console.log(n)},onResults:function(e,t,n){console.log("results")},introTpl:'<div class="quiz_intro"><h2><%this.title%></h2><%if(this.description){%><p><%this.description%></p><%}%></div>',questionTpl:'<div class="'+q+'"><div class="'+g+'"><%this.question.__num%>.</div><div class="'+w+'"><h2><%this.question.question%></h2><%if(this.question.description){%><p><%this.question.description%></p><%}%><%for(var index in this.answers){%><div class="quiz_radiogroup"><input type="radio" id="answer-<%this.answers[index].__id%>" name="question<%this.question.__id%>" value="<%this.answers[index].__id%>" data-quiz-name="quizUID_<%this.question.__id%>" data-quiz-value="<%this.answers[index].__id%>"<%this.answers[index].__checked%>><label for="answer-<%this.answers[index].__id%>"><span></span> <%this.answers[index].answer%></label></div><%}%></div></div>',resultsTpl:'<div class="'+q+'"><div class="'+g+'"><%this.question.__num%>.</div><div class="'+w+'"><h2><%this.question.question%></h2><%if(this.question.description){%><p><%this.question.description%></p><%}%><%if(this.answer){%><div class="quiz_response"><strong><%this.answer.__num%>.</strong> <%this.answer.answer%></div><%if(this.answer.true == 1){%><div class="'+b+' quiz_success"><i class="fa fa-thumbs-up" aria-hidden="true"></i><%this.answer.alert%></div><%} else{%><div class="'+b+' quiz_fail"><i class="fa fa-thumbs-down" aria-hidden="true"></i><%this.answer.alert%></div><%}%><%}%></div></div>',startBtnTpl:'<button class="'+T+' quiz_btn_start"><%this.messages.start%><i class="fa fa-play" aria-hidden="true"></i></button>',prevBtnTpl:'<button class="'+T+' quiz_btn_prev"><i class="fa fa-step-backward" aria-hidden="true"></i><%this.messages.prev%></button>',nextBtnTpl:'<button class="'+T+' quiz_btn_next"><%this.messages.next%>'+y+"</button>",resultBtnTpl:'<button class="'+T+' quiz_btn_result"><%this.messages.results%>'+y+"</button>",restartBtnTpl:'<button class="'+T+' quiz_btn_rewind">'+x+"<%this.messages.restart%></button>",modalBtnTpl:'<button class="'+T+'" data-dismiss="modal">'+x+"<%this.messages.restart%></button>",progressTpl:!1},B={localization:function(n){"object"==typeof n&&e.extend(t,n)}};if("string"==typeof n){if(B[n])return B[n].apply(this,Array.prototype.slice.call(arguments,1));n={quizJson:n}}if("object"==typeof n&&!n.quizJson){var S=d.data("quizJson");"string"==typeof S&&(n.quizJson=S)}function J(){(function(){if($(),i)return e(H(a.introTpl,i)).appendTo("#"+f),e(H(a.startBtnTpl,{messages:t})).appendTo("#"+h).on("click",(function(e){e.preventDefault(),O(l)})),!0;O(l)})()&&(R("intro"),C("step_intro"),F(0))}function D(){a.fade?e("#"+f).fadeOut(300,(function(){J(),e("#"+f).fadeIn(300)})):J()}function I(n){var o=function(e){return s[e]&&[e,s[e]]||null}(n);o&&(R(n=o[0]+1),function(n){$();var o="quizUID_"+n[0],u=JSON.parse(G(m))||P(),l=n[1];l.__id=n[0],l.__num=n[0]+1;var d=[];e.each(l.answers,(function(e,t){var n=t;n.__id=e,n.__num=e+1,n.__checked="",u&&u[o]&&u[o]==e&&(n.__checked=" checked"),d.push(n)})),$question=e(H(a.questionTpl,{question:l,answers:d})).appendTo("#"+f);try{var c=$question.find("[data-quiz-name]");if(!c.length)throw new Error("No response set!");c.on("click",(function(t){var i=JSON.parse(G(m))||P(),o=e(this).data("quizName"),r=e(this).data("quizValue"),u={};u[o]=""+r,function(e,t){!function(e,t,n){s[e][t]=n}(e,"__response",t)}(n[0],u[o]),e.extend(i,u),A(m,JSON.stringify(i),a.cookieExpire)}))}catch(e){console.error(e)}a.hidePrevBtn||(i||0!=n[0])&&e(H(a.prevBtnTpl,{question:l,messages:t})).appendTo("#"+h).on("click",(function(t){t.preventDefault();var i=n[0];"function"==typeof a.onStep&&a.onStep.apply(e("#"+p),[i,r,s[i]]),i-1<0?D():O(i-1)}));!function(t){var n=!0;return e.each(s,(function(e,s){e>t&&(n=!1)})),n}(n[0])?e(H(a.nextBtnTpl,{question:l,messages:t})).appendTo("#"+h).on("click",(function(t){t.preventDefault();var i=n[0];"function"==typeof a.onStep&&a.onStep.apply(e("#"+p),[i,r,s[i]]),Q(i)&&O(i+1)})):e(H(a.resultBtnTpl,{question:l,messages:t})).appendTo("#"+h).on("click",(function(t){t.preventDefault();var i=n[0];"function"==typeof a.onStep&&a.onStep.apply(e("#"+p),[i,r,s[i]]),Q(i)&&N()}))}(o),C("step_"+n),F(n))}function O(t){a.fade?e("#"+f).fadeOut(300,(function(){I(t),e("#"+f).fadeIn(300)})):I(t)}function E(){R("results"),function(){$(),u=0;var n=JSON.parse(G(m))||P();e.each(s,(function(t,s){var i="quizUID_"+t,o=s;o.__id=t,o.__num=t+1,e.each(s.answers,(function(e,t){n&&n[i]&&n[i]==e&&(answer=t,answer.__id=e,answer.__num=e+1,1==t.true&&u++)})),$question=e(H(a.resultsTpl,{question:o,answer:answer||!1})).appendTo("#"+f)})),a.hideRestartBtn||e(H(a.restartBtnTpl,{messages:t})).appendTo("#"+h).on("click",(function(e){e.preventDefault(),j(),V(m),a.randomQuestions&&U(s),D()}))}(),C("step_results"),F(r),"function"==typeof a.onResults&&a.onResults.apply(e("#"+p),[u,r,s])}function N(){a.fade?e("#"+f).fadeOut(300,(function(){E(),e("#"+f).fadeIn(300)})):E()}function P(){var t={};return e.each(s,(function(e,n){n.__response&&(t["quizUID_"+e]=n.__response)})),t}function j(){e.each(s,(function(e,t){t.__response&&delete t.__response}))}function Q(n){var i,o=JSON.parse(G(m))||P(),r=!0;return o||(o={},A(m,JSON.stringify(o),a.cookieExpire)),e.each(s,(function(e,s){return i="quizUID_"+e,e<n&&!o[i]?(M(t.errmsg[1],!0),r=!1,!1):e!=n||o[i]?void 0:(M(t.errmsg[0],!1),r=!1,!1)})),r}function R(e){if(!a.hidePrevBtn)switch(e){case"intro":o=null,window.location.hash="";break;case"results":o="results",window.location.hash="step=results";break;default:o=e,window.location.hash="step="+e}}function U(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),s=e[t];e[t]=e[n],e[n]=s}}function C(t){e("#"+p).removeClass().addClass(t)}function $(){e("#"+f).empty(),e("#"+h).empty()}function F(t){var n=t/r*100;if("string"==typeof a.progressTpl){var s={step:t,total:r,percent:n};e("#"+v).html(H(a.progressTpl,{progress:s}))}else{var i=e("#"+v).find("."+z);i.length||(i=e('<div class="'+z+'" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>').appendTo("#"+v)),i.attr("aria-valuenow",n).css("width",n+"%").html(t+"/"+r)}}function M(n,s){var i=e("#"+_);if(i.length)i.find(".modal-body").text(n).end().find(".modal-footer").css("display",s?"flex":"none").end().modal("show");else{var o='<div id="'+_+'" class="modal fade" role="dialog" aria-hidden="true" aria-labelledby="quiz_mdltitle" tabindex="-1"><div class="modal-dialog modal-dialog-centered" role="document"><div class="modal-content">';o+='<div class="modal-header"><h5 class="modal-title">'+t.error+'</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>',o+='<div class="modal-body text-danger" aria-live="polite"></div>',o+='<div class="modal-footer"></div>',o+="</div>",o+="</div>",e(o+="</div>").appendTo("body"),a.hideRestartBtn||e(H(a.modalBtnTpl,{messages:t})).appendTo("#"+_+" .modal-footer").on("click",(function(e){e.preventDefault(),j(),V(m),D()})),setTimeout((function(){M(n,s)}),10)}}function A(e,t,n){var s="";if(n){var i=new Date;i.setTime(i.getTime()+1e3*n),s="; expires="+i.toUTCString()}document.cookie=e+"="+(t||"")+s+"; path=/"}function G(e){for(var t=e+"=",n=document.cookie.split(";"),s=0;s<n.length;s++){for(var i=n[s];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return null}function V(e){document.cookie=e+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"}function H(e,t){var n,s,i=/<%(.+?)%>/g,o=/(^( )?(var|if|for|else|switch|case|break|{|}|;))(.*)?/g,a="with(obj) { var r=[];\n",r=0;function u(e,t){return a+=t?e.match(o)?e+"\n":"r.push("+e+");\n":""!=e?'r.push("'+e.replace(/"/g,'\\"')+'");\n':"",u}for(;s=i.exec(e);)u(e.slice(r,s.index))(s[1],!0),r=s.index+s[0].length;u(e.substr(r,e.length-r)),a=(a+'return r.join(""); }').replace(/[\r\t\n]/g," ");try{n=new Function("obj",a).apply(t,[t])}catch(e){console.error("'"+e.message+"'"," in \n\nCode:\n",a,"\n")}return n}return e.extend(a,k,n),e(window).bind("hashchange",(function(e){if(!a.hidePrevBtn)if(""!=window.location.hash||null==o){var t=window.location.hash.substr(1).split("=")[1];/^\+?(0|[1-9]\d*)$/.test(t)?parseInt(o)!=parseInt(t)&&O(t-1):"results"==t&&o!=t&&N()}else D()})),function(){try{if(!e(document).modal)throw new Error("Bootstrap 4 is required");if(!a.quizJson)throw new Error("Set url to quiz json file")}catch(e){console.error(e)}var t;t=e(c).prop("id",p).appendTo(d),e(c).prop("id",f).appendTo(t),e(c).prop("id",h).attr("role","group").appendTo(t),e(c).prop("id",v).appendTo(t),e.getJSON(a.quizJson+"?_="+(new Date).getTime()).done((function(e,t,n){if(s=e[0].questions,a.randomQuestions&&(U(s),a.hidePrevBtn=!0),"number"==typeof a.numQuestions&&a.numQuestions<s.length&&(s=s.slice(0,parseInt(a.numQuestions))),i=e[0].intro||!1,r=s.length,!a.hidePrevBtn&&window.location.hash){var o=window.location.hash.substr(1).split("=")[1];/^\+?(0|[1-9]\d*)$/.test(o)?O(o-1):"results"==o&&N()}else D()})).fail((function(e,t,n){console.error("Fail"),console.error("Error "+t),console.error("Incoming Text "+e.responseText)}))}(),this}}(jQuery);