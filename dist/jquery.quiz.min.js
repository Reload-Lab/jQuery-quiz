/*!
 * jQuery Quiz Plugin
 * https://github.com/Reload-Lab/jQuery-quiz
 *
 * @updated February 25, 2022
 * @version 2.0
 *
 * @author Domenico Gigante - domenico.gigante@reloadlab.it
 * @copyright (c) 2022 Reload Laboratorio Multimediale - httpa://www.reloadlab.it
 * @license MIT
 */
!function(e){var t={start:"Start",prev:"Back",next:"Forward",results:"Go to results",restart:"Back to the top",error:"Error",errmsg:["Please choose an answer.","Some questions have not been answered. Please, back to the top to answer all questions."]};e.quiz=e.fn.quiz=function(n){var s,i,o,a={},r=0,u=0,l=0,d="object"==typeof this?this.first():null,c="<div>",p="quiz-container",f="quiz-body",h="quiz-buttons",v="quiz-progress",m="quiz-modal",g="quiz_flex",q="quiz_flexfill",w="quiz_num",b="quiz_alert",T="quiz_btn",y="quiz_response",x="quiz_progressbar",z='<i class="fa fa-play" aria-hidden="true"></i>',k='<i class="fa fa-step-backward" aria-hidden="true"></i>',B='<i class="fa fa-step-forward" aria-hidden="true"></i>',S='<i class="fa fa-repeat" aria-hidden="true"></i>',J='<i class="fa fa-thumbs-up" aria-hidden="true"></i>',_='<i class="fa fa-thumbs-down" aria-hidden="true"></i>',O={quizJson:null,cookieExpire:3600,hidePrevBtn:!1,hideRestartBtn:!1,fade:!0,randomQuestions:!1,numQuestions:!1,onStep:function(e,t){console.log(e)},onResults:function(e,t){console.log("results")},introTpl:'<div class="quiz_intro"><h2><%this.title%></h2><%if(this.description){%><p><%this.description%></p><%}%></div>',questionTpl:'<div class="'+g+'"><div class="'+w+'"><%this.question.num%>.</div><div class="'+q+'"><h2><%this.question.question%></h2><%if(this.question.description){%><p><%this.question.description%></p><%}%><%for(var index in this.answers){%><div class="quiz_radiogroup"><input type="radio" id="answer-<%this.answers[index].num%>" name="question<%this.question.id%>" value="<%this.answers[index].num%>" data-quiz-name="question<%this.question.id%>" data-quiz-value="<%this.answers[index].num%>"<%this.answers[index].checked%>><label for="answer-<%this.answers[index].num%>"><span></span> <%this.answers[index].answer%></label></div><%}%></div></div>',resultsTpl:'<div class="'+g+'"><div class="'+w+'"><%this.question.num%>.</div><div class="'+q+'"><h2><%this.question.question%></h2><%if(this.question.description){%><p><%this.question.description%></p><%}%><%if(this.answer){%><div class="'+y+'"><strong><%this.answer.num + 1%>.</strong> <%this.answer.answer%></div><%if(this.answer.true == 1){%><div class="'+b+' quiz_success">'+J+'<%this.answer.alert%></div><%} else{%><div class="'+b+' quiz_fail">'+_+"<%this.answer.alert%></div><%}%><%}%></div></div>",startBtnTpl:'<button class="'+T+'"><%this.messages.start%>'+z+"</button>",prevBtnTpl:'<button class="'+T+'">'+k+"<%this.messages.prev%></button>",nextBtnTpl:'<button class="'+T+'"><%this.messages.next%>'+B+"</button>",resultBtnTpl:'<button class="'+T+'"><%this.messages.results%>'+B+"</button>",restartBtnTpl:'<button class="'+T+'">'+S+"<%this.messages.restart%></button>",modalBtnTpl:'<button class="'+T+'" data-dismiss="modal">'+S+"<%this.messages.restart%></button>",progressTpl:!1},N={localization:function(n){"object"==typeof n&&e.extend(t,n)}};if("string"==typeof n){if(N[n])return N[n].apply(this,Array.prototype.slice.call(arguments,1));n={quizJson:n}}if("object"==typeof n&&!n.quizJson){var E=d.data("quizJson");"string"==typeof E&&(n.quizJson=E)}function j(){try{if(!e(document).modal)throw new Error("Bootstrap 4 is required");if(!a.quizJson)throw new Error("Set url to quiz json file")}catch(e){console.error(e)}U(),e.getJSON(a.quizJson+"?_="+(new Date).getTime()).done((function(e,t,n){if(s=e[0].questions,a.randomQuestions&&(G(s),a.hidePrevBtn=!0),"number"==typeof a.numQuestions&&a.numQuestions<s.length&&(s=s.slice(0,parseInt(a.numQuestions))),i=!!e[0].intro&&e[0].intro,r=s.length,!a.hidePrevBtn&&window.location.hash){var o=window.location.hash.substr(1).split("=")[1];/^\+?(0|[1-9]\d*)$/.test(o)?I(o-1):"results"==o&&C()}else P()})).fail((function(e,t,n){console.error("Fail"),console.error("Error "+t),console.error("Incoming Text "+e.responseText)}))}function D(){K()&&(M("intro"),V("step_intro"),X(0),"function"==typeof a.onStep&&a.onStep.apply(e("#"+p),["intro",r]))}function P(){a.fade?e("#"+f).fadeOut(300,(function(){D(),e("#"+f).fadeIn(300)})):D()}function Q(t){var n=$(t);n&&(M(t=n[0]+1),L(n),V("step_"+t),X(t),"function"==typeof a.onStep&&a.onStep.apply(e("#"+p),[t,r]))}function I(t){a.fade?e("#"+f).fadeOut(300,(function(){Q(t),e("#"+f).fadeIn(300)})):Q(t)}function R(){M("results"),W(),V("step_results"),X(r),"function"==typeof a.onStep&&a.onStep.apply(e("#"+p),["results",r]),"function"==typeof a.onResults&&a.onResults.apply(e("#"+p),[u,r])}function C(){a.fade?e("#"+f).fadeOut(300,(function(){R(),e("#"+f).fadeIn(300)})):R()}function $(t){var n;return e.each(s,(function(e,s){e==t&&(n=[e,s])})),n}function F(n){var i,o=JSON.parse(ee("response")),r=!0;return o||(o={},Z("response",JSON.stringify(o),a.cookieExpire)),e.each(s,(function(e,s){return i="question"+e,e<n&&!o[i]?(Y(t.errmsg[1],!0),r=!1,!1):e!=n||o[i]?void 0:(Y(t.errmsg[0],!1),r=!1,!1)})),r}function A(t){var n=!0;return e.each(s,(function(e,s){e>t&&(n=!1)})),n}function M(e){if(!a.hidePrevBtn)switch(e){case"intro":o=null,window.location.hash="";break;case"results":o="results",window.location.hash="step=results";break;default:o=e,window.location.hash="step="+e}}function G(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),s=e[t];e[t]=e[n],e[n]=s}}function U(){var t=e(c).prop("id",p).appendTo(d);e(c).prop("id",f).appendTo(t),e(c).prop("id",h).attr("role","group").appendTo(t),e(c).prop("id",v).appendTo(t)}function V(t){e("#"+p).removeClass().addClass(t)}function H(){e("#"+f).empty(),e("#"+h).empty()}function K(){if(H(),i)return e(te(a.introTpl,i)).appendTo("#"+f),e(te(a.startBtnTpl,{messages:t})).appendTo("#"+h).on("click",(function(e){e.preventDefault(),I(l)})),!0;I(l)}function L(n){H();var s="question"+n[0],i=JSON.parse(ee("response")),o=n[1];o.id=n[0],o.num=n[0]+1;var r=[];e.each(o.answers,(function(e,t){var n=t;n.num=e,n.checked="",i&&i[s]&&i[s]==e&&(n.checked=" checked"),r.push(n)})),$question=e(te(a.questionTpl,{question:o,answers:r})).appendTo("#"+f);try{var u=$question.find("[data-quiz-name]");if(!u.length)throw new Error("No response set!");u.on("click",(function(t){var n=JSON.parse(ee("response"))||{},s=e(this).data("quizName"),i=e(this).data("quizValue"),o={};o[s]=""+i,e.extend(n,o),Z("response",JSON.stringify(n),a.cookieExpire)}))}catch(e){console.error(e)}a.hidePrevBtn||e(te(a.prevBtnTpl,{question:o,messages:t})).appendTo("#"+h).on("click",(function(e){e.preventDefault();var t=n[0];t-1<0?P():I(t-1)})),A(n[0])?e(te(a.resultBtnTpl,{question:o,messages:t})).appendTo("#"+h).on("click",(function(e){e.preventDefault(),F(n[0])&&C()})):e(te(a.nextBtnTpl,{question:o,messages:t})).appendTo("#"+h).on("click",(function(e){e.preventDefault();var t=n[0];F(t)&&I(t+1)}))}function W(){H(),u=0;var n=JSON.parse(ee("response"));e.each(s,(function(t,s){var i="question"+t,o=s;o.id=t,o.num=t+1,e.each(s.answers,(function(e,t){n&&n[i]&&n[i]==e&&(answer=t,answer.num=e,1==t.true&&u++)})),$question=e(te(a.resultsTpl,{question:o,answer:answer||!1})).appendTo("#"+f)})),a.hideRestartBtn||e(te(a.restartBtnTpl,{messages:t})).appendTo("#"+h).on("click",(function(e){e.preventDefault();Z("response",JSON.stringify({}),a.cookieExpire),a.randomQuestions&&G(s),P()}))}function X(t){var n=t/r*100;if(a.progressTpl){var s={step:t,total:r,percent:n};e("#"+v).html(te(a.progressTpl,{progress:s}))}else{var i=e("#"+v).find("."+x);i.length||(i=e('<div class="'+x+'" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>').appendTo("#"+v)),i.attr("aria-valuenow",n).css("width",n+"%").html(t+"/"+r)}}function Y(n,s){var i=e("#"+m);if(i.length)i.find(".modal-body").text(n).end().find(".modal-footer").css("display",s?"flex":"none").end().modal("show");else{var o='<div id="'+m+'" class="modal fade" role="dialog" aria-hidden="true" aria-labelledby="quiz_mdltitle" tabindex="-1"><div class="modal-dialog modal-dialog-centered" role="document"><div class="modal-content">';o+='<div class="modal-header"><h5 class="modal-title">'+t.error+'</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>',o+='<div class="modal-body text-danger" aria-live="polite"></div>',o+='<div class="modal-footer"></div>',o+="</div>",o+="</div>",e(o+="</div>").appendTo("body"),a.hideRestartBtn||e(te(a.modalBtnTpl,{messages:t})).appendTo("#"+m+" .modal-footer").on("click",(function(e){e.preventDefault();Z("response",JSON.stringify({}),a.cookieExpire),P()})),setTimeout((function(){Y(n,s)}),10)}}function Z(e,t,n){var s="";if(n){var i=new Date;i.setTime(i.getTime()+1e3*n),s="; expires="+i.toUTCString()}document.cookie=e+"="+(t||"")+s+"; path=/"}function ee(e){for(var t=e+"=",n=document.cookie.split(";"),s=0;s<n.length;s++){for(var i=n[s];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return null}function te(e,t){var n,s,i=/<%(.+?)%>/g,o=/(^( )?(var|if|for|else|switch|case|break|{|}|;))(.*)?/g,a="with(obj) { var r=[];\n",r=0;function u(e,t){return a+=t?e.match(o)?e+"\n":"r.push("+e+");\n":""!=e?'r.push("'+e.replace(/"/g,'\\"')+'");\n':"",u}for(;s=i.exec(e);)u(e.slice(r,s.index))(s[1],!0),r=s.index+s[0].length;u(e.substr(r,e.length-r)),a=(a+'return r.join(""); }').replace(/[\r\t\n]/g," ");try{n=new Function("obj",a).apply(t,[t])}catch(e){console.error("'"+e.message+"'"," in \n\nCode:\n",a,"\n")}return n}return e.extend(a,O,n),e(window).bind("hashchange",(function(e){if(!a.hidePrevBtn)if(""!=window.location.hash||null==o){var t=window.location.hash.substr(1).split("=")[1];/^\+?(0|[1-9]\d*)$/.test(t)?parseInt(o)!=parseInt(t)&&I(t-1):"results"==t&&o!=t&&C()}else P()})),j(),this}}(jQuery);